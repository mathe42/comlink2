<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>comlink2 API Playground</title>
  
  <script type="module">
    import { 
      wrap, 
      expose, 
      streamToPostMessage, 
      postMessageToStream,
      createChannel,
      connectEndpoints,
      connectStreams,
      withLogging
    } from './src/index.js';


    // Service der exposed wird
    const testService = {
      greet: (name) => `Hello ${name}!`,
      calculate: (a, b) => a + b,
      getData: async () => ({ 
        timestamp: Date.now(), 
        random: Math.random(),
        message: 'Data from remote service'
      }),
      throwError: () => { 
        throw new Error('Test error from remote service') 
      },
      processArray: (arr) => arr.map(x => x * 2),
      createUser: function(name, email) {
        return { 
          id: Math.random().toString(36), 
          name, 
          email, 
          created: new Date().toISOString() 
        }
      },
      a: class {
        fn() {
          console.log('test')
        }
        cb(c) {
          c()
        }
      }
    };

    const mc = new MessageChannel()
    mc.port1.start()
    mc.port2.start()
    const d = wrap(withLogging(mc.port1))
    expose(testService, mc.port2)
    

    
    
    // Oder mit async/await:
    ;(async () => {
      try {
        const greeting = await d.greet('Sebastian')
        console.log('Async greet result:', greeting)
        
        const sum = await d.calculate(5, 3)
        console.log('Calculate result:', sum)
        
        const data = await d.getData()
        console.log('Data result:', data)
        
        const g = await d.greet
        console.log(g())

        // Class Test
        // const instance = await new d.a()
        // await instance.fn()
        // console.log('Class instance:', instance)

        // instance.cb(() => console.log('dhgdhg'))
        
      } catch (error) {
        console.error('Error:', error)
      }
    })()

  </script>
</body>
</html>